apiVersion: v1
kind: Pod
metadata:
  labels:
    run: bgp-container
  name: bgp-container
  annotations:
    "cni.projectcalico.org/ipAddrs": "[\"10.17.158.54\"]"
spec:
  containers:
  - image: magicsong/gobgp:v0.0.1
    name: bgp-container
    resources: 
      requests:
        memory: "64Mi"
        cpu: "100m"
      limits:
        memory: "128Mi"
        cpu: "200m"
    volumeMounts:
    - name: bgp-config
      mountPath:  /etc/gobgp/
  restartPolicy: Always
  volumes:
  - name:  bgp-config
    configMap:
        name: bgp-config

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: bgp-config
  labels:
    app: bgp-container
data:
  gobgp.conf: |
    [global.config]
      as = 65002
      router-id = "10.17.158.54"
      port = 179
    [global.apply-policy.config]
      default-import-policy = "accept-route"
      default-export-policy = "accept-route"
    [global.use-multiple-paths.config]
      enabled = true
    [[neighbors]]
       [[neighbors.afi-safis]]
         [neighbors.afi-safis.config]
         afi-safi-name = "ipv4-unicast"
       [neighbors.graceful-restart.config]
         enabled = true
         restart-time = 120
      [neighbors.config]
        neighbor-address = "192.168.98.8"
        peer-as = 65001
      [neighbors.transport.config]
        bind-interface = "eth0"
        local-address = "10.17.158.54"
      [neighbors.add-paths.config]
          send-max = 8
          receive = true
          
